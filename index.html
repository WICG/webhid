<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <title>
      WebHID API
    </title>
    <script src='https://www.w3.org/Tools/respec/respec-w3c' async class=
    'remove'></script>
    <script class='remove'>
      var respecConfig = {
        specStatus: "CG-DRAFT",
        latestVersion: null,
        editors: [{
          name: "Matt Reynolds", w3cid: "105511",
          company: "Google", companyURL: "https://www.google.com/"
        }],
        github: "WICG/webhid",
        group: "wicg",
        xref: ["DOM", "HTML", "INFRA", "PERMISSIONS-POLICY", "POINTEREVENTS", "UIEVENTS", "GAMEPAD"],
        localBiblio: {
          "USBIF-HID-CLASS": {
            "authors": [
                "Mike Bergman"
            ],
            "etAl": true,
            "href": "https://www.usb.org/document-library/device-class-definition-hid-111",
            "title": "Device Class Definition for Human Interface Devices (HID) version 1.11",
            "date": "May 27, 2001",
            "status": "Specification",
            "publisher": "USB Implementers Forum",
          },
          "USBIF-HID-USAGE": {
            "authors": [
                "David Abzarian"
            ],
            "etAl": true,
            "href": "https://www.usb.org/document-library/hid-usage-tables-122",
            "title": "HID Usage Tables for Universal Serial Bus (USB) version 1.22",
            "date": "April 6, 2021",
            "status": "Specification",
            "publisher": "USB Implementers Forum",
          },
        },
      };
    </script>
  </head>
  <body>
    <section id='abstract'>
      <p>
        This document describes an API for providing access to devices that
        support the Human Interface Device (HID) protocol.
      </p>
    </section>
    <section id='sotd'>
      <!-- This section is filled automatically by ReSpec. -->
    </section>
    <section class="informative">
      <h2>
        Introduction
      </h2>
      <p>
        A HID (Human Interface Device) is a type of device that takes input
        from or provides output to humans. It also refers to the HID protocol,
        a standard for bi-directional communication between a host and a device
        that is designed to simplify the installation procedure. The HID
        protocol was originally developed for USB devices but has since been
        implemented over many other protocols, including Bluetooth.
      </p>
      <p>
        The web platform already supports input from many HID devices.
        Keyboards, pointing devices, and gamepads are all typically implemented
        using the HID protocol. However, this support relies on the operating
        system's HID drivers that transform the HID input into high-level input
        APIs. Devices that are not well supported by the host's HID driver are
        often inaccessible to web pages. Similarly, the outputs on most devices
        that are not supported by the host's HID driver are inaccessible.
      </p>
      <p>
        See also the related <a href="EXPLAINER.html">Explainer</a> document.
      </p>
    </section>
    <section class="informative" id='motivating-applications'>
      <h2>
        Motivating Applications
      </h2>
      <section>
        <h3>
          Niche devices
        </h3>
        <p>
          The most common classes of HID input devices are already
          well-supported on the web platform through existing high-level input
          APIs. For instance, mouse input is accessible through
          {{PointerEvent}} and keyboard input is accessible through
          {{KeyboardEvent}}. Input from these devices is handled using the
          host's native HID driver and typically does not require
          device-specific drivers or configuration to work correctly. WebHID is
          not intended for devices like these that are already well-supported
          through high-level input APIs.
        </p>
        <p>
          For some classes of HID devices, the web platform supports some
          features of the device but limits access to other features. For
          instance, [[GAMEPAD]] supports the input capabilities of most game
          controllers but does not support less common capabilities like LED
          indicators or audio. These features are often not well-supported by
          host APIs and adding support within the user agent can lead to
          significant complexity. WebHID would give applications an alternative
          when the functionality provided by the high-level API is incomplete.
        </p>
        <p>
          Many HID devices are not supported through any web platform API. The
          HID specification describes a wide array of devices that could be
          supported through HID, including virtual reality controls, flight
          simulators, medical equipment, and more. WebHID would allow these
          devices to be used without requiring additional drivers or
          modification to the user agent.
        </p>
      </section>
      <section>
        <h3>
          Prototyping, hobbyists, and educational devices
        </h3>
        <p>
          HID is attractive for prototyping and hobbyist applications because
          it allows devices to use the host's generic HID driver instead of
          requiring a driver for each host where the device will be used. The
          simplified installation procedure also makes it easier for educators
          to deploy a device to a classroom of students without modifying the
          system configuration on each host. Providing access to HID devices
          through the web platform would further reduce installation
          requirements, particularly for devices that are currently only
          supported through host-specific applications.
        </p>
      </section>
    </section>
    <section class="informative" id='security-and-privacy'>
      <h2>
        Security and Privacy Considerations
      </h2>
      <section id='abusing-access'>
        <h3>
          Abusing Access to a Device
        </h3>
        <p>
          HID peripherals may expose powerful functionality that should not be
          made accessible to the page without explicit consent from the user.
          For instance, a HID peripheral may have sensors that allow it to
          collect information about its surroundings. A device may store
          private information that should not be revealed or overwritten. Many
          devices expose functionality that allow the device firmware to be
          upgraded. Operating systems typically do not restrict access to HID
          devices from applications, and this access can occasionally be abused
          to damage the device or corrupt the data stored on it.
        </p>
        <p>
          In some cases, a device may expose functionality that should not be
          accessible at all from a web page. Specific devices may be blocked by
          recognizing the device by its [=vendor ID=] and [=product ID=] and
          hiding such devices during enumeration. The [=report descriptor=]
          allows a device to describe its own capabilities, and this
          information can be used to block classes of devices even when the
          [=vendor ID=] and [=product ID=] cannot be known in advance. This can
          be accomplished by inspecting the [=HID usage=] values assigned to
          collections within the [=report descriptor=]; for instance, access to
          keyboard-like devices can be denied by denying access to devices that
          include a [=top-level collection=] with the [=HID usage=] for a
          keyboard.
        </p>
        <p>
          To mitigate abuse, a device will not be made available to the page
          until the user has granted explicit access. Access must first be
          requested by the page and will be granted once the user has selected
          the device from a chooser displaying all available devices. Once a
          page has been granted access, an indicator will be displayed to
          indicate the device is in use.
        </p>
      </section>
      <section id='attacking-a-device'>
        <h3>
          Attacking a Device
        </h3>
        <p>
          The HID protocol is extremely versatile, and a wide variety of
          devices have been designed that take advantage of this versatility.
          As a result, there are many possibilities for how access to a device
          could allow a malicious page to damage the device itself. It is
          relatively common for HID peripherals to allow firmware updates to be
          sent using custom HID reports. Device manufacturers must take care to
          design the firmware upgrade mechanism to verify that the firmware
          binary is authentic, and should also protect against downgrades that
          could reduce the security of a device. Untrusted upgrades could be
          used to add new capabilities to a device or cause it to masquerade as
          an entirely different type of device.
        </p>
        <p>
          Some devices may be damaged when inputs are provided outside of the
          expected range. For instance, the rumble feature on a gamepad could
          become damaged if a page sends an invalid rumble command.
        </p>
        <p>
          In general, these types of attacks are device-specific and cannot be
          mitigated at the API level.
        </p>
      </section>
      <section id='attacking-the-host'>
        <h3>
          Attacking the Host
        </h3>
        <p>
          If a malicious page gains access to a device, in some cases this
          access can be used to attack the host. A major concern is whether the
          device can be used to generate trusted input events. These events
          serve as a proxy for user intent and can be used to access more
          powerful web platform features.
        </p>
        <p>
          Mice and keyboards are typically implemented as HID peripherals, and
          are also capable of generating trusted input. A HID keyboard or mouse
          may contain advanced features like programmable macros, which store a
          sequence of inputs and allow the sequence to be played back at a
          later time. Device manufacturers must take care to design such
          features in a way that would prevent a malicious app from
          reprogramming the device with an unexpected input sequence, and must
          also protect against triggering macro playback without the user's
          explicit consent.
        </p>
      </section>
      <section id='mitigation'>
        <h3>
          Mitigation
        </h3>
        <p>
          To mitigate security and privacy risks, it is recommended that user
          agents implement a chooser-based flow for requesting device access.
          When a page requests access to a HID device, the user agent should
          display a dialog that informs the user that the page wants to access
          a device. The dialog should display a list of connected HID devices
          and ask the user to select a device that will be exposed to the page.
          To reduce the possibility of accidental clicks, the dialog should
          require two separate interactions: one interaction to select the
          device from the list and a second interaction to confirm the
          selection and dismiss the dialog.
        </p>
      </section>
    </section>
    <section data-dfn-for="Navigator">
      <h2>
        Extensions to the `Navigator` interface
      </h2>
      <pre class="idl">
        [SecureContext] partial interface Navigator {
            [SameObject] readonly attribute HID hid;
        };
      </pre>
      <h3>
        <dfn>hid</dfn> attribute
      </h3>
      <p>
        When getting, the {{Navigator/hid}} attribute always returns the same
        instance of the {{HID}} object.
      </p>
    </section>
    <section data-dfn-for="HID">
      <h2>
        `HID` interface
      </h2>
      <pre class="idl">
        [Exposed=Window, SecureContext]
        interface HID : EventTarget {
            attribute EventHandler onconnect;
            attribute EventHandler ondisconnect;
            Promise&lt;sequence&lt;HIDDevice&gt;&gt; getDevices();
            Promise&lt;sequence&lt;HIDDevice&gt;&gt; requestDevice(
                HIDDeviceRequestOptions options);
        };
      </pre>
      <p>
        Instances of {{HID}} are created with the internal slots described in
        the following table:
      </p>
      <table class="simple">
        <tr>
          <th>
            Internal slot
          </th>
          <th>
            Initial value
          </th>
          <th>
            Description (non-normative)
          </th>
        </tr>
        <tr>
          <td>
            <dfn data-dfn-for="HID">[[\devices]]</dfn>
          </td>
          <td>
            An empty [=ordered set=]
          </td>
          <td>
            An [=ordered set=] of {{HIDDevice}} instances representing the
            [=HID interfaces=] currently available on the system
          </td>
        </tr>
      </table>
      <dl>
        <dt>
          <dfn>onconnect</dfn> attribute
        </dt>
        <dd>
          {{HID/onconnect}} is an [=event handler IDL attribute=] for the
          <dfn>connect</dfn> event type.
        </dd>
        <dt>
          <dfn>ondisconnect</dfn> attribute
        </dt>
        <dd>
          {{HID/ondisconnect}} is an [=event handler IDL attribute=] for the
          <dfn>disconnect</dfn> event type.
        </dd>
      </dl>
      <p>
        When a [=HID interface=] becomes available on the system, run the
        following steps:
      </p>
      <div class="note">
        <p>
          A <dfn>HID interface</dfn> is a logical interface that can be used to
          communicate with a device over the HID protocol. Each [=HID
          interface=] has exactly one [=report descriptor=] that describes the
          set of reports supported by that interface. A single physical device
          may expose more than one [=HID interface=]. Devices with multiple
          [=HID interfaces=] run these steps once for each interface.
        </p>
        <p>
          For example, USB devices are implemented as a collection of
          interfaces, each of which may specify an interface class. When a
          device has multiple USB interfaces that use the HID class, each
          interface is enumerated as a separate [=HID interface=].
        </p>
      </div>
      <ol>
        <li>Let |device:HIDDevice| be a {{HIDDevice}}.
        </li>
        <li>Set |device|.{{HIDDevice/[[vendorId]]}} to the [=vendor ID=] of the
        device that exposes the interface.
        </li>
        <li>Set |device|.{{HIDDevice/[[productId]]}} to the [=product ID=] of
        the device that exposes the interface.
        </li>
        <li>Set |device|.{{HIDDevice/[[productName]]}} to the [=product name=]
        of the device that exposes the interface.
        </li>
        <li>Set |device|.{{HIDDevice/[[collections]]}} to the result of
        [=parsing the Report descriptor=].
        </li>
        <li>Let |hid:HID| be the result of calling |device|'s [=relevant global
        object=]'s {{Navigator}} object's {{Navigator/hid}} getter.
        </li>
        <li>[=list/Append=] |device| to |hid|.{{HID/[[devices]]}}.
        </li>
        <li>If the user has allowed the site to access |device| as the result
        of a previous call to {{HID/requestDevice()}}, then [=queue a global
        task=] on the [=relevant global object=] of |hid| using the [=HID
        device task source=] to [=fire an event=] named {{connect}} at |hid|
        using {{HIDConnectionEvent}} with its {{HIDConnectionEvent/device}}
        attribute initialized to |device|.
        </li>
      </ol>
      <p>
        To <dfn data-lt="parsing the report descriptor">parse the report
        descriptor</dfn>, run the following steps:
      </p>
      <div class="note">
        <p>
          The system will typically read the [=report descriptor=] [=byte
          sequence=] for each [=HID interface=] when a device is first
          connected and cache the values in the system registry. If the
          [=report descriptor=] is not available but the system provides
          information that can be used to reconstruct the layout of each
          report, the user agent may use an alternate algorithm instead of
          parsing the [=report descriptor=].
        </p>
        <p>
          The [=report descriptor=] format is described in
          [[USBIF-HID-CLASS]] section 6.2.2. The algorithm below is intended
          to implement the same parsing algorithm described in that section.
        </p>
        <p>
          The [=report descriptor=] contains three classes of items.
          <dfn>Main items</dfn> are used to define and group data fields.
          <dfn>Global items</dfn> and <dfn>Local items</dfn> describe the
          data fields. [=Local items=] define characteristics that only apply
          to the next [=Main item=], while [=Global items=] define
          characteristics that affect all subsequently defined [=Main
          items=].
        </p>
        <p>
          Each item has a <dfn>item data field</dfn> containing 0, 1, 2, or 4
          bytes of data associated with the item and a <dfn>bSize field</dfn>
          that describes how many bytes are used to store the [=item data
          field=]. Each item also has a tag that identifies its type.
        </p>
        </div>
      <ol>
        <li>Let |items| be the result of converting the [=report descriptor=]
        [=byte sequence=] into a [=list=] of [=Main items=], [=Global items=],
        and [=Local items=].
        </li>
        <li>Initialize |collections:sequence&lt;HIDCollectionInfo&gt;| to be an
        empty [=sequence=] of {{HIDCollectionInfo}}.
        </li>
        <li>Initialize |ancestors| to be an empty [=list=].
        </li>
        <li>Initialize |localState| to be an empty [=ordered map=].
        </li>
        <li>Initialize |usages| to be an empty [=sequence=] of `unsigned long`.
        </li>
        <li>Initialize |stringIndices| to be an empty [=list=].
        </li>
        <li>Initialize |globalStack| to be an empty [=stack=].
        </li>
        <li>Initialize |initialGlobalState| to be an empty [=ordered map=].
        </li>
        <li>Initialize |reportId| to 0.
        </li>
        <li>Set |initialGlobalState|["{{HIDReportItem/unitSystem}}"] to
        {{HIDUnitSystem/"none"}}.
        </li>
        <li>Set |initialGlobalState|["{{HIDReportItem/unitExponent}}"] to 0.
        </li>
        <li>Set
        |initialGlobalState|["{{HIDReportItem/unitFactorLengthExponent}}"] to
        0.
        </li>
        <li>Set
        |initialGlobalState|["{{HIDReportItem/unitFactorMassExponent}}"] to 0.
        </li>
        <li>Set
        |initialGlobalState|["{{HIDReportItem/unitFactorTimeExponent}}"] to 0.
        </li>
        <li>Set
        |initialGlobalState|["{{HIDReportItem/unitFactorTemperatureExponent}}"]
        to 0.
        </li>
        <li>Set
        |initialGlobalState|["{{HIDReportItem/unitFactorCurrentExponent}}"] to
        0.
        </li>
        <li>Set
        |initialGlobalState|["{{HIDReportItem/unitFactorLuminousIntensityExponent}}"]
        to 0.
        </li>
        <li>Set |initialGlobalState|["{{HIDReportItem/logicalMinimum}}"] to 0.
        </li>
        <li>Set |initialGlobalState|["{{HIDReportItem/logicalMaximum}}"] to 0.
        </li>
        <li>Set |initialGlobalState|["{{HIDReportItem/physicalMinimum}}"] to 0.
        </li>
        <li>Set |initialGlobalState|["{{HIDReportItem/physicalMaximum}}"] to 0.
        </li>
        <li>[=stack/Push=] |initialGlobalState| onto |globalStack|.
        </li>
        <li>[=list/For each=] |item| of |items|:
          <div class="note">
            <p>
              [=Main items=] are described in [[USBIF-HID-CLASS]] sections
              6.2.2.4 through 6.2.2.6. An item with the <dfn>Input tag</dfn>,
              <dfn>Output tag</dfn>, or <dfn>Feature tag</dfn> defines a field
              within an input, output, or feature report. The [=item data
              field=] of a [=Main item=] with an [=Input tag=], [=Output tag=],
              or [=Feature tag=] is a bit field containing several boolean
              parameters describing the data field. An item with the
              <dfn>Collection tag</dfn> defines a new collection nested within
              the current collection, or a new [=top-level collection=] if
              there is no current collection. The [=item data field=] of a
              [=Main item=] with a [=Collection tag=] contains the
              <dfn>collection type</dfn>. An item with the <dfn>End Collection
              tag</dfn> closes the current collection.
            </p>
          </div>
          <ul>
            <li>If |item| is a [=Main item=]:
              <ol>
                <li>If |item| has the [=Input tag=], [=Output tag=], or
                [=Feature tag=]:
                  <ol>
                    <li>Let |globalState| be the last [=list/item=] of
                    |globalStack|.
                    </li>
                    <li>Let |reportId:octet| be
                    |globalState|["{{HIDReportInfo/reportId}}"].
                    </li>
                    <li>Let |reportItem:HIDReportItem| be the result of
                    [=creating a HID report item=] with |item|, |localState|,
                    |globalState|, |usages|, and |strings|.
                    </li>
                    <li>[=list/For each=] |collection:HIDCollectionInfo| of
                    |ancestors|:
                      <ol>
                        <li>Let |reports:sequence&lt;HIDCollectionInfo&gt;| be:
                          <ul>
                            <li>
                            |collection|["{{HIDCollectionInfo/inputReports}}"]
                            if |item| has the [=Input tag=],
                            </li>
                            <li>
                            |collection|["{{HIDCollectionInfo/outputReports}}"]
                            if |item| has the [=Output tag=], or
                            </li>
                            <li>
                            |collection|["{{HIDCollectionInfo/featureReports}}"]
                            if |item| has the [=Feature tag=].
                            </li>
                          </ul>
                        </li>
                        <li>
                          <p>
                            If |reports| contains an item with its
                            {{HIDReportInfo/reportId}} attribute equal to
                            |reportId|, then let |report| be that item.
                          </p>
                          <p>
                            Otherwise:
                          </p>
                          <ol>
                            <li>Let |report:HIDReportInfo| be a [=new=]
                            {{HIDReportInfo}} dictionary.
                            </li>
                            <li>Set |report|["{{HIDReportInfo/reportId}}"] to
                            |reportId|.
                            </li>
                            <li>Set |report|["{{HIDReportInfo/items}}"] to an
                            empty [=sequence=] of {{HIDReportItem}}.
                            </li>
                            <li>[=list/Append=] |report| to |reports|.
                            </li>
                          </ol>
                        </li>
                        <li>[=list/Append=] |item| to
                        |report|["{{HIDReportInfo/items}}"].
                        </li>
                      </ol>
                    </li>
                  </ol>
                </li>
                <li>If |item| has the [=Collection tag=]:
                  <ol>
                    <li>Let |collection:HIDCollectionInfo| be a [=new=]
                    {{HIDCollectionInfo}} dictionary.
                    </li>
                    <li>Let |usage| be the first [=list/item=] of |usages|.
                    </li>
                    <li>If the [=list/size=] of |usages| is greater than 1,
                    remove the first [=list/item=] of |usages|.
                    </li>
                    <li>Set |collection|["{{HIDCollectionInfo/usagePage}}"] to
                    |globalState|["{{HIDCollectionInfo/usagePage}}"].
                    </li>
                    <li>Set |collection|["{{HIDCollectionInfo/usage}}"] to
                    |usage|.
                    </li>
                    <li>Set |collection|["{{HIDCollectionInfo/type}}"] to the
                    value representing the collection's type.
                    </li>
                    <li>Set |collection|["{{HIDCollectionInfo/children}}"] to
                    an empty [=sequence=] of {{HIDCollectionInfo}}.
                    </li>
                    <li>Set |collection|["{{HIDCollectionInfo/inputReports}}"]
                    to an empty [=sequence=] of {{HIDReportInfo}}.
                    </li>
                    <li>Set |collection|["{{HIDCollectionInfo/outputReports}}"]
                    to an empty [=sequence=] of {{HIDReportInfo}}.
                    </li>
                    <li>Set
                    |collection|["{{HIDCollectionInfo/featureReports}}"] to an
                    empty [=sequence=] of {{HIDReportInfo}}.
                    </li>
                    <li>
                      <p>
                        If |ancestors| [=list/is empty=], [=list/append=]
                        |collection| to |collections|.
                      </p>
                      <p>
                        Otherwise:
                      </p>
                      <ol>
                        <li>Let |parent:HIDCollectionInfo| be the last
                        [=list/item=] of |ancestors|.
                        </li>
                        <li>[=list/Append=] |collection| to
                        |parent|["{{HIDCollectionInfo/children}}"].
                        </li>
                      </ol>
                    </li>
                    <li>[=list/Append=] |collection| to |ancestors|.
                    </li>
                  </ol>
                </li>
                <li>If |item| has the [=End Collection tag=], then
                [=list/remove=] the last [=list/item=] of |ancestors|.
                </li>
                <li>Set |localState| to be an empty [=ordered map=].
                </li>
                <li>Set |usages| to be an empty [=sequence=] of `unsigned
                long`.
                  <div class="note">
                    <p>
                      [=Global items=] are described in section 6.2.2.7. An
                      item with the <dfn>Usage Page tag</dfn>, <dfn>Logical
                      Minimum tag</dfn>, <dfn>Logical Maximum tag</dfn>,
                      <dfn>Physical Minimum tag</dfn>, <dfn>Physical Maximum
                      tag</dfn>, <dfn>Unit Exponent tag</dfn>, <dfn>Unit
                      tag</dfn>, <dfn>Report Size tag</dfn>, <dfn>Report ID
                      tag</dfn>, or <dfn>Report Count tag</dfn> modifies the
                      respective field of the global item state table. An item
                      with the <dfn>Push tag</dfn> pushes a copy of the current
                      global item state table onto the item state stack. An
                      item with the <dfn>Pop tag</dfn> replaces the global item
                      state table with the top of the item state stack. The
                      global Report ID value is not affected when manipulating
                      the item state stack.
                    </p>
                  </div>
                </li>
                <li>If |item| is a [=Global item=]:
                  <ol>
                    <li>Let |globalState| be the last [=list/item=] of
                    |globalStack|.
                    </li>
                    <li>Let |value:unsigned long| be the [=item data field=]
                    interpreted as an `unsigned long`.
                    </li>
                    <li>If |item| has the [=Usage Page tag=], then set
                    |globalState|["{{HIDCollectionInfo/usagePage}}"] to
                    |value|.
                    </li>
                    <li>If |item| has the [=Logical Minimum tag=], then set
                    |globalState|["{{HIDReportItem/logicalMinimum}}"] to
                    |value|.
                    </li>
                    <li>If |item| has the [=Logical Maximum tag=], then set
                    |globalState|["{{HIDReportItem/logicalMaximum}}"] to
                    |value|.
                    </li>
                    <li>If |item| has the [=Physical Minimum tag=], then set
                    |globalState|["{{HIDReportItem/physicalMinimum}}"] to
                    |value|.
                    </li>
                    <li>If |item| has the [=Physical Maximum tag=], then set
                    |globalState|["{{HIDReportItem/physicalMaximum}}"] to
                    |value|.
                    </li>
                    <li>If |item| has the [=Report Size tag=], then set
                    |globalState|["{{HIDReportItem/reportSize}}"] to |value|.
                    </li>
                    <li>If |item| has the [=Report ID tag=], then set
                    |globalState|["{{HIDReportInfo/reportId}}"] to |value|.
                    </li>
                    <li>If |item| has the [=Report Count tag=], then set
                    |globalState|["{{HIDReportItem/reportCount}}"] to |value|.
                    </li>
                    <li>If |item| has the [=Unit tag=]:
                      <ol>
                        <li>Let |nibbles| be the result of interpreting |value|
                        as a [=sequence=] of eight 4-bit signed two's
                        complement integers starting from the low-order bits.
                        </li>
                        <li>If |nibbles|[0] is:
                          <ul>
                            <li>0, then set
                            |globalState|["{{HIDReportItem/unitSystem}}"] to
                            {{HIDUnitSystem/"none"}}
                            </li>
                            <li>1, then set
                            |globalState|["{{HIDReportItem/unitSystem}}"] to
                            {{HIDUnitSystem/"si-linear"}}
                            </li>
                            <li>2, then set
                            |globalState|["{{HIDReportItem/unitSystem}}"] to
                            {{HIDUnitSystem/"si-rotation"}}
                            </li>
                            <li>3, then set
                            |globalState|["{{HIDReportItem/unitSystem}}"] to
                            {{HIDUnitSystem/"english-linear"}}
                            </li>
                            <li>4, then set
                            |globalState|["{{HIDReportItem/unitSystem}}"] to
                            {{HIDUnitSystem/"english-rotation"}}
                            </li>
                            <li>-1, then set
                            |globalState|["{{HIDReportItem/unitSystem}}"] to
                            {{HIDUnitSystem/"vendor-defined"}}
                            </li>
                            <li>Otherwise, set
                            |globalState|["{{HIDReportItem/unitSystem}}"] to
                            {{HIDUnitSystem/"reserved"}}
                            </li>
                          </ul>
                        </li>
                        <li>Set
                        |globalState|["{{HIDReportItem/unitFactorLengthExponent}}"]
                        to |nibbles|[1].
                        </li>
                        <li>Set
                        |globalState|["{{HIDReportItem/unitFactorMassExponent}}"]
                        to |nibbles|[2].
                        </li>
                        <li>Set
                        |globalState|["{{HIDReportItem/unitFactorTimeExponent}}"]
                        to |nibbles|[3].
                        </li>
                        <li>Set
                        |globalState|["{{HIDReportItem/unitFactorTemperatureExponent}}"]
                        to |nibbles|[4].
                        </li>
                        <li>Set
                        |globalState|["{{HIDReportItem/unitFactorCurrentExponent}}"]
                        to |nibbles|[5].
                        </li>
                        <li>Set
                        |globalState|["{{HIDReportItem/unitFactorLuminousIntensityExponent}}"]
                        to |nibbles|[6].
                        </li>
                      </ol>
                    </li>
                    <li>If |item| has the [=Unit Exponent tag=], then set
                    |globalState|["{{HIDReportItem/unitExponent}}"] to the
                    result of interpreting the lowest 4 bits of the [=item data
                    field=] as a signed two's complement integer.
                    </li>
                    <li>If |item| has the [=Push tag=], then [=stack/push=] a
                    copy of |globalState| onto |globalStack|.
                    </li>
                    <li>If |item| has the [=Pop tag=], then [=stack/pop=] from
                    |globalStack|.
                    </li>
                  </ol>
                </li>
              </ol>
              <div class="note">
                <p>
                  [=Local items=] are described in section 6.2.2.8. An item
                  with the <dfn>Usage tag</dfn>, <dfn>Usage Minimum tag</dfn>,
                  <dfn>Usage Maximum tag</dfn>, <dfn>String Index tag</dfn>,
                  <dfn>String Minimum tag</dfn>, or <dfn>String Maximum
                  tag</dfn> modifies the respective field of the local item
                  state table. The local item state is cleared after each
                  [=Main item=].
                </p>
              </div>
            </li>
            <li>If |item| is a [=Local item=]:
              <ol>
                <li>Let |value:unsigned long| be the [=item data field=]
                interpreted as an `unsigned long`.
                </li>
                <li>If |item| has the [=Usage tag=]:
                  <ol>
                    <li>If |item|'s [=bSize field=] is 1 or 2:
                      <ol>
                        <li>Let |usageId:unsigned short| be an `unsigned short`
                        containing the lower 16 bits of |value|.
                        </li>
                        <li>Let |globalState| be the last [=list/item=] of
                        |globalStack|.
                        </li>
                        <li>Set |value| to a [=HID usage=] composed of
                        |globalState|["{{HIDCollectionInfo/usagePage}}"] in the
                        high order bits and |usageId| in the low order bits.
                        </li>
                      </ol>
                    </li>
                    <li>[=list/Append=] |value| to |usages|.
                    </li>
                  </ol>
                </li>
                <li>If |item| has the [=Usage Minimum tag=], then set
                |localState|["{{HIDReportItem/usageMinimum}}"] to |value|.
                </li>
                <li>If |item| has the [=Usage Maximum tag=], then set
                |localState|["{{HIDReportItem/usageMaximum}}"] to |value|.
                </li>
                <li>If |item| has the [=String Index tag=], then
                [=list/append=] |value| to |stringIndices|.
                </li>
                <li>If |item| has the [=String Minimum tag=], then set
                |localState|[`"stringMinimum"`] to |value|.
                </li>
                <li>If |item| has the [=String Maximum tag=], then set
                |localState|[`"stringMaximum"`] to |value|.
                </li>
              </ol>
            </li>
          </ul>
        </li>
      </ol>
      <p>
        To <dfn data-lt="creating a HID report item">create a HID report
        item</dfn> with |item|, |localState|, |globalState|, |usages|, and
        |stringIndices|, run the following steps:
      </p>
      <ol>
        <li>Let |reportItem:HIDReportItem| be a [=new=] {{HIDReportItem}}
        dictionary.
        </li>
        <li>Let |value:unsigned long| be the [=item data field=] interpreted as
        an `unsigned long`.
        </li>
        <li>Let |bitfield| be a [=list=] of `boolean` values representing each
        of the bits of |value|, starting from the low-order bits.
        </li>
        <li>Set |reportItem|["{{HIDReportItem/isConstant}}"] to |bitfield|[0].
        </li>
        <li>Set |reportItem|["{{HIDReportItem/isArray}}"] to !|bitfield|[1].
        </li>
        <li>Set |reportItem|["{{HIDReportItem/isAbsolute}}"] to !|bitfield|[2].
        </li>
        <li>Set |reportItem|["{{HIDReportItem/wrap}}"] to |bitfield|[3].
        </li>
        <li>Set |reportItem|["{{HIDReportItem/isLinear}}"] to !|bitfield|[4].
        </li>
        <li>Set |reportItem|["{{HIDReportItem/hasPreferredState}}"] to
        |bitfield|[5].
        </li>
        <li>Set |reportItem|["{{HIDReportItem/hasNull}}"] to |bitfield|[6].
        </li>
        <li>Set |reportItem|["{{HIDReportItem/isVolatile}}"] to |bitfield|[7].
        </li>
        <li>Set |reportItem|["{{HIDReportItem/isBufferedBytes}}"] to
        |bitfield|[8].
        </li>
        <li>Set |reportItem|["{{HIDReportItem/usages}}"] to |usages|.
        </li>
        <li>Set |reportItem|["{{HIDReportItem/reportSize}}"] to
        |globalState|["{{HIDReportItem/reportSize}}"].
        </li>
        <li>Set |reportItem|["{{HIDReportItem/reportCount}}"] to
        |globalState|["{{HIDReportItem/reportCount}}"].
        </li>
        <li>Set |reportItem|["{{HIDReportItem/unitExponent}}"] to
        |globalState|["{{HIDReportItem/unitExponent}}"].
        </li>
        <li>Set |reportItem|["{{HIDReportItem/unitSystem}}"] to
        |globalState|["{{HIDReportItem/unitSystem}}"].
        </li>
        <li>Set |reportItem|["{{HIDReportItem/unitFactorLengthExponent}}"] to
        |globalState|["{{HIDReportItem/unitFactorLengthExponent}}"].
        </li>
        <li>Set |reportItem|["{{HIDReportItem/unitFactorMassExponent}}"] to
        |globalState|["{{HIDReportItem/unitFactorMassExponent}}"].
        </li>
        <li>Set |reportItem|["{{HIDReportItem/unitFactorTimeExponent}}"] to
        |globalState|["{{HIDReportItem/unitFactorTimeExponent}}"].
        </li>
        <li>Set |reportItem|["{{HIDReportItem/unitFactorTemperatureExponent}}"]
        to |globalState|["{{HIDReportItem/unitFactorTemperatureExponent}}"].
        </li>
        <li>Set |reportItem|["{{HIDReportItem/unitFactorCurrentExponent}}"] to
        |globalState|["{{HIDReportItem/unitFactorCurrentExponent}}"].
        </li>
        <li>Set
        |reportItem|["{{HIDReportItem/unitFactorLuminousIntensityExponent}}"]
        to
        |globalState|["{{HIDReportItem/unitFactorLuminousIntensityExponent}}"].
        </li>
        <li>Set |reportItem|["{{HIDReportItem/logicalMinimum}}"] to
        |globalState|["{{HIDReportItem/logicalMinimum}}"].
        </li>
        <li>Set |reportItem|["{{HIDReportItem/logicalMaximum}}"] to
        |globalState|["{{HIDReportItem/logicalMaximum}}"].
        </li>
        <li>Set |reportItem|["{{HIDReportItem/physicalMinimum}}"] to
        |globalState|["{{HIDReportItem/physicalMinimum}}"].
        </li>
        <li>Set |reportItem|["{{HIDReportItem/physicalMaximum}}"] to
        |globalState|["{{HIDReportItem/physicalMaximum}}"].
        </li>
        <li>
          <p>
            If "{{HIDReportItem/usageMinimum}}" is in |localState|, then set
            |reportItem|["{{HIDReportItem/usageMinimum}}"] to
            |localState|["{{HIDReportItem/usageMinimum}}"].
          </p>
        </li>
        <li>
          <p>
            If "{{HIDReportItem/usageMaximum}}" is in |localState|, then set
            |reportItem|["{{HIDReportItem/usageMaximum}}"] to
            |localState|["{{HIDReportItem/usageMaximum}}"].
          </p>
        </li>
        <li>Set |reportItem|["{{HIDReportItem/isRange}}"] to `true` if
        |reportItem|["{{HIDReportItem/usageMinimum}}"] is less than
        |reportItem|["{{HIDReportItem/usageMaximum}}"], or `false` otherwise.
        </li>
        <li>If `"stringMinimum"` is in |localState| and `"stringMaximum"` is in
        |localState|:
          <ol>
            <li>[=list/Append=] the [=list/item=]s of [=the range=] from
            |localState|[`"stringMinimum"`] to |localState|[`"stringMaximum"`]
            to |stringIndices|.
            </li>
          </ol>
        </li>
        <li>[=list/For each=] |stringIndex| of |stringIndices|:
          <ol>
            <li>Let |string| be the result of reading the string descriptor at
            index |stringIndex|.
            </li>
            <li>[=list/Append=] |string| to
            |reportItem|["{{HIDReportItem/strings}}"].
            </li>
          </ol>
        </li>
        <li>Return |reportItem|.
        </li>
      </ol>
      <p>
        When a [=HID interface=] becomes unavailable on the system, run the
        following steps:
      </p>
      <ol>
        <li>Let |device:HIDDevice| be the {{HIDDevice}} in
        |hid|.{{HID/[[devices]]}} representing the interface.
        </li>
        <li>Let |hid:HID| be the result of calling |device|'s [=relevant global
        object=]'s {{Navigator}} object's {{Navigator/hid}} getter.
        </li>
        <li>[=list/Remove=] |device| from |hid|.{{HID/[[devices]]}}.
        </li>
        <li>If the user has allowed the site to access |device| as the result
        of a previous call to {{HID/requestDevice()}}, then [=queue a global
        task=] on the [=relevant global object=] of |hid| using the [=HID
        device task source=] to [=fire an event=] named {{disconnect}} at |hid|
        using {{HIDConnectionEvent}} with its {{HIDConnectionEvent/device}}
        attribute initialized to |device|.
        </li>
      </ol>
      <section>
        <h3>
          <dfn>getDevices()</dfn> method
        </h3>
        <p>
          The {{HID/getDevices()}} method steps are:
        </p>
        <ol>
          <li>Let |promise:Promise| be [=a new promise=].
          </li>
          <li>If [=this=]'s [=relevant global object=]'s [=associated
          Document=] is not [=allowed to use=] the [=policy-controlled
          feature=] named `"hid"`, [=reject=] |promise| with a
          "{{SecurityError}}" {{DOMException}} and return |promise|.
          </li>
          <li>Run the following steps [=in parallel=]:
            <ol>
              <li>Let |devices:sequence&lt;HIDDevice&gt;| be an empty
              [=sequence=] of {{HIDDevice}}.
              </li>
              <li>[=list/For each=] |device:HIDDevice| of
              [=this=].{{HID/[[devices]]}}:
                <ol>
                  <li>If the user has allowed the site to access |device| as
                  the result of a previous call to {{HID/requestDevice()}} and
                  |device|.{{HIDDevice/[[state]]}} is not `"forgotten"`,
                  then [=list/append=] |device| to |devices|.
                  </li>
                </ol>
              </li>
              <li>[=Queue a global task=] on the [=relevant global object=] of
              [=this=] using the [=HID device task source=] to [=resolve=]
              |promise| with |devices|.
              </li>
            </ol>
          </li>
          <li>Return |promise|.
          </li>
        </ol>
      </section>
      <section>
        <h3>
          <dfn>requestDevice()</dfn> method
        </h3>
        <div class="note">
          <p>
            The {{HID/requestDevice()}} permission dialog presents a list of
            connected devices and asks the user to select one.
          </p>
          <p>
            If a device has multiple [=HID interfaces=], the dialog MAY present
            only a single item that represents all the interfaces. When the
            user selects an item that represents multiple [=HID interfaces=],
            the user agent MUST grant access to all the [=HID interfaces=]
            exposed by the device.
          </p>
        </div>
        <p>
          The {{HID/requestDevice()}} method steps are:
        </p>
        <ol>
          <li>Let |promise:Promise| be [=a new promise=].
          </li>
          <li>If [=this=]'s [=relevant global object=]'s [=associated
          Document=] is not [=allowed to use=] the [=policy-controlled
          feature=] named `"hid"`, [=reject=] |promise| with a
          "{{SecurityError}}" {{DOMException}} and return |promise|.
          </li>
          <li>If the [=relevant global object=] of [=this=] does not have
          [=transient activation=], [=reject=] |promise| with a
          "{{SecurityError}}" {{DOMException}} and return |promise|.
          </li>
          <li>If |options|["{{HIDDeviceRequestOptions/filters}}"] is present,
          then run the following steps [=list/for each=]
          |filter:HIDDeviceFilter| of
          |options|["{{HIDDeviceRequestOptions/filters}}"]:
          <ol>
            <li>If |filter| is not [=a valid filter=], then [=reject=] |promise|
            with a {{TypeError}} and return |promise|.
            </li>
          </ol>
          </li>
          <li>If |options|["{{HIDDeviceRequestOptions/exclusionFilters}}"] is
          present, then run the following steps:
            <ol>
              <li>If |options|["{{HIDDeviceRequestOptions/exclusionFilters}}"] is
              empty, then [=reject=] |promise| with a {{TypeError}} and return
              |promise|.
              </li>
              <li>[=list/For each=] |exclusionFilter:HIDDeviceFilter| of
              |options|["{{HIDDeviceRequestOptions/exclusionFilters}}"]:
                <ol>
                  <li>If |exclusionFilter| is not [=a valid filter=], then
                  [=reject=] |promise| with a {{TypeError}} and return
                  |promise|.
                  </li>
                </ol>
              </li>
            </ol>
          </li>
          <li>Run the following steps [=in parallel=]:
            <ol>
              <li>Initialize |availableDevices| to be an empty [=list=].
              </li>
              <li>[=list/For each=] |device:HIDDevice| of
              [=this=].{{HID/[[devices]]}}:
                <ol>
                  <li>If |device| [=matches any filter=] in
                  |options|["{{HIDDeviceRequestOptions/filters}}"] and |device|
                  does not [=match any filter=] in
                  |options|["{{HIDDeviceRequestOptions/exclusionFilters}}"],
                  then [=list/append=] |device| to |availableDevices|.
                  </li>
                </ol>
              </li>
              <li>Prompt the user to grant the site access to a HID device by
              presenting them with the list of devices in |availableDevices|.
                <div class="note">
                  The user agent may modify the device list before presenting
                  it to the user. For example, devices with multiple [=HID
                  interfaces=] SHOULD be represented by a single item such that
                  selecting the item grants access to all interfaces exposed by
                  the device. Whether a device is implemented as a single
                  interface or a collection of interfaces is an implementation
                  detail that may not be known by the user and should not be
                  considered relevant for device access permissions.
                </div>
              </li>
              <li>Let |devices:sequence&lt;HIDDevice&gt;| be an empty
              [=sequence=] of {{HIDDevice}}.
              </li>
              <li>If the user does not choose a device, [=queue a global task=]
              on the [=relevant global object=] of [=this=] using the [=HID
              device task source=] to [=resolve=] |promise| with |devices| and
              abort these steps.
              </li>
              <li>[=list/For each=] |device:HIDDevice| of
              [=this=].{{HID/[[devices]]}}:
                <ol>
                  <li>If |device| represents a [=HID interface=] exposed by the
                  chosen device, then set |device|.{{HIDDevice/[[state]]}} to
                  `"closed"` and [=list/append=] |device| to |devices|.
                  </li>
                </ol>
              </li>
              <li>[=Queue a global task=] on the [=relevant global object=] of
              |device| using the [=HID device task source=] to [=resolve=]
              |promise| with |devices|.
              </li>
            </ol>
          </li>
          <li>Return |promise|.
          </li>
        </ol>
        <section data-dfn-for="HIDDeviceRequestOptions">
          <h4>
            <dfn>HIDDeviceRequestOptions</dfn> dictionary
          </h4>
          <pre class="idl">
            dictionary HIDDeviceRequestOptions {
                required sequence&lt;HIDDeviceFilter&gt; filters;
                sequence&lt;HIDDeviceFilter&gt; exclusionFilters;
            };
          </pre>
          <dl>
            <dt>
              <dfn>filters</dfn> member
            </dt>
            <dd>
              Filters for HID devices.
            </dd>
            <dt>
              <dfn>exclusionFilters</dfn> member
            </dt>
            <dd>
              Exclusion filters for HID devices.
            </dd>
          </dl>
        </section>
        <section data-dfn-for="HIDDeviceFilter">
          <h4>
            <dfn>HIDDeviceFilter</dfn> dictionary
          </h4>
          <pre class="idl">
            dictionary HIDDeviceFilter {
                unsigned long vendorId;
                unsigned short productId;
                unsigned short usagePage;
                unsigned short usage;
            };
          </pre>
          <dl>
            <dt>
              <dfn>vendorId</dfn> member
            </dt>
            <dd>
              The [=vendor ID=] to match.
            </dd>
            <dt>
              <dfn>productId</dfn> member
            </dt>
            <dd>
              The [=product ID=] to match. If the {{HIDDeviceFilter/vendorId}}
              member is not present, {{HIDDeviceFilter/productId}} is ignored.
            </dd>
            <dt>
              <dfn>usagePage</dfn> member
            </dt>
            <dd>
              The [=top-level collection=] [=usage page=] to match.
            </dd>
            <dt>
              <dfn>usage</dfn> member
            </dt>
            <dd>
              The [=top-level collection=] [=usage ID=] to match. If the
              {{HIDDeviceFilter/usagePage}} member is not present,
              {{HIDDeviceFilter/usage}} is ignored.
            </dd>
          </dl>
          <div class="note">
            <p>
              Device filters are used to narrow the list of devices presented to
              the user in the chooser dialog created by {{HID/requestDevice()}}.
              When no filters are provided, all connected devices matching no
              exclusion filters are included. When one or more filters are
              provided, a device is included if any filter matches and no
              exclusion filters matches.
            </p>
            <p>
              All {{HIDDeviceFilter}} members are optional. Each member
              specifies a rule. To match a {{HIDDeviceFilter}}, every rule must
              be satisfied. An empty {{HIDDeviceFilter}} matches any device.
            </p>
            <p>
              Device ID rules are used to select devices by their [=vendor ID=]
              and [=product ID=]. This is useful when an application is only
              designed to work with a specific device, or otherwise relies on
              vendor-specific functionality. Including a
              {{HIDDeviceFilter/vendorId}} rule causes the filter to only match
              devices with the specified [=vendor ID=]. If a
              {{HIDDeviceFilter/productId}} rule is also included, the filter
              will only match devices with the specified [=vendor ID=] and
              [=product ID=]. {{HIDDeviceFilter/productId}} is ignored if it is
              specified without a {{HIDDeviceFilter/vendorId}} rule.
            </p>
            <p>
              Usage rules are used to select devices by the [=HID usages=]
              assigned to the [=top-level collections=] of the device. This is
              useful when an application is designed to work with a standard
              class of device. To match a device, at least one of the device's
              collections must match every usage rule. Including a
              {{HIDDeviceFilter/usagePage}} rule causes the filter to only
              match if the device contains a collection with the specified
              [=usage page=]. If a {{HIDDeviceFilter/usage}} rule is also
              included, the filter will only match devices with the specified
              [=usage page=] and [=usage ID=]. {{HIDDeviceFilter/usage}} is
              ignored if it is specified without a
              {{HIDDeviceFilter/usagePage}} rule.
            </p>
            <p>
              Device ID rules and usage rules may be combined. For instance, an
              application may want to match devices from a particular vendor,
              but only devices that implement a specific device class.
            </p>
            <p>
              The {{HIDDeviceRequestOptions/exclusionFilters}} option allows an
              application to exclude some devices presented to the user from the
              chooser dialog created by {{HID/requestDevice()}} that are known
              to not work as expected, even though they implement a specific
              device class for instance.
            </p>
          </div>
          <p>
            A {{HIDDeviceFilter}} |filter:HIDDeviceFilter| is <dfn>a valid
            filter</dfn> if these steps return `true`:
          </p>
          <ol>
            <li>If |filter| is empty, then return `false`.
            </li>
            <li>If |filter|["{{HIDDeviceFilter/productId}}"] is present and
            |filter|["{{HIDDeviceFilter/vendorId}}"] is not present, then return
            `false`.
            </li>
            <li>If |filter|["{{HIDDeviceFilter/usage}}"] is present and
            |filter|["{{HIDDeviceFilter/usagePage}}"] is not present, then
            return `false`.
            </li>
            <li>Return `true`.
            </li>
          </ol>
          <p>
            A {{HIDDevice}} |device:HIDDevice| <dfn data-lt="match any
            filter">matches any filter</dfn> in a [=sequence=]
            |filters:sequence&lt;HIDDeviceFilter&gt;| of {{HIDDeviceFilter}} if
            these steps return `true`:
          </p>
          <ol>
            <li>If |filters| is empty, then return `true`.
            </li>
            <li>[=list/For each=] |filter:HIDDeviceFilter| of |filters|:
              <ol>
                <li>If |filter| [=matches the device IDs=] of |device| and
                |filter| [=matches any collection=] of |device|, then return
                `true`.
                </li>
              </ol>
            </li>
            <li>Return `false`.
            </li>
          </ol>
          <p>
            A {{HIDDeviceFilter}} |filter:HIDDeviceFilter| <dfn>matches the
            device IDs</dfn> of |device:HIDDevice| if these steps return
            `true`:
          </p>
          <ol>
            <li>If "{{HIDDeviceFilter/vendorId}}" is in |filter|:
              <ol>
                <li>If |filter|["{{HIDDeviceFilter/vendorId}}"] is not equal to
                |device|.{{HIDDevice/vendorId}}, then return `false`.
                </li>
                <li>If "{{HIDDeviceFilter/productId}}" is in |filter| and
                |filter|["{{HIDDeviceFilter/productId}}"] is not equal to
                |device|.{{HIDDevice/productId}}, then return `false`.
                </li>
              </ol>
            </li>
            <li>Return `true`.
            </li>
          </ol>
          <p>
            A {{HIDDeviceFilter}} |filter:HIDDeviceFilter| <dfn>matches any
            collection</dfn> of |device:HIDDevice| if these steps return
            `true`:
          </p>
          <ol>
            <li>[=list/For each=] |collection:HIDCollectionInfo| of
            |device|.{{HIDDevice/collections}}:
              <ol>
                <li>If |filter| [=matches the collection=] |collection| then
                return `true`.
                </li>
              </ol>
            </li>
            <li>Return `false`.
            </li>
          </ol>
          <p>
            A {{HIDDeviceFilter}} |filter:HIDDeviceFilter| <dfn>matches the
            collection</dfn> |collection:HIDCollectionInfo| if these steps
            return `true`:
          </p>
          <ol>
            <li>If "{{HIDDeviceFilter/usagePage}}" is in |filter|:
              <ol>
                <li>If |filter|["{{HIDDeviceFilter/usagePage}}"] is not equal
                to |collection|.{{HIDCollectionInfo/usagePage}}, then return
                `false`.
                </li>
                <li>If "{{HIDCollectionInfo/usage}}" is in |filter| and
                |filter|["{{HIDDeviceFilter/usage}}"] is not equal to
                |collection|.{{HIDCollectionInfo/usage}}, then return `false`.
                </li>
              </ol>
            </li>
            <li>Return `true`.
            </li>
          </ol>
        </section>
      </section>
    </section>
    <section data-dfn-for="HIDDevice">
      <h2>
        `HIDDevice` interface
      </h2>
      <pre class="idl">
        [Exposed=Window, SecureContext]
        interface HIDDevice : EventTarget {
            attribute EventHandler oninputreport;
            readonly attribute boolean opened;
            readonly attribute unsigned short vendorId;
            readonly attribute unsigned short productId;
            readonly attribute DOMString productName;
            readonly attribute FrozenArray&lt;HIDCollectionInfo&gt; collections;
            Promise&lt;undefined&gt; open();
            Promise&lt;undefined&gt; close();
            Promise&lt;undefined&gt; forget();
            Promise&lt;undefined&gt; sendReport([EnforceRange] octet reportId, BufferSource data);
            Promise&lt;undefined&gt; sendFeatureReport(
                [EnforceRange] octet reportId,
                BufferSource data);
            Promise&lt;DataView&gt; receiveFeatureReport([EnforceRange] octet reportId);
        };
      </pre>
      <p>
        Methods on this interface typically complete asynchronously, queuing
        work on the <dfn>HID device task source</dfn>.
      </p>
      <p>
        Instances of {{HIDDevice}} are created with the internal slots
        described in the following table:
      </p>
      <table class="simple">
        <tr>
          <th>
            Internal slot
          </th>
          <th>
            Initial value
          </th>
          <th>
            Description (non-normative)
          </th>
        </tr>
        <tr>
          <td>
            <dfn data-dfn-for="HIDDevice">[[\state]]</dfn>
          </td>
          <td>
            `"closed"`
          </td>
          <td>
            Tracks the active state of the {{HIDDevice}}
          </td>
        </tr>
        <tr>
          <td>
            <dfn data-dfn-for="HIDDevice">[[\vendorId]]</dfn>
          </td>
          <td>
            0
          </td>
          <td>
            The [=vendor ID=] of the device
          </td>
        </tr>
        <tr>
          <td>
            <dfn data-dfn-for="HIDDevice">[[\productId]]</dfn>
          </td>
          <td>
            0
          </td>
          <td>
            The [=product ID=] of the device
          </td>
        </tr>
        <tr>
          <td>
            <dfn data-dfn-for="HIDDevice">[[\productName]]</dfn>
          </td>
          <td>
            `""`
          </td>
          <td>
            The [=product name=] of the device
          </td>
        </tr>
        <tr>
          <td>
            <dfn data-dfn-for="HIDDevice">[[\collections]]</dfn>
          </td>
          <td>
            An empty [=sequence=] of {{HIDCollectionInfo}}
          </td>
          <td>
            The [=top-level collections=] created by [=parsing the report
            descriptor=]
          </td>
        </tr>
        <tr>
          <td>
            <dfn data-dfn-for="HIDDevice">[[\pendingSendReportPromises]]</dfn>
          </td>
          <td>
            An empty [=list=]
          </td>
          <td>
            Pending {{HIDDevice/sendReport()}} {{Promise}}s
          </td>
        </tr>
        <tr>
          <td>
            <dfn data-dfn-for=
            "HIDDevice">[[\pendingSendFeatureReportPromises]]</dfn>
          </td>
          <td>
            An empty [=list=]
          </td>
          <td>
            Pending {{HIDDevice/sendFeatureReport()}} {{Promise}}s
          </td>
        </tr>
        <tr>
          <td>
            <dfn data-dfn-for=
            "HIDDevice">[[\pendingReceiveFeatureReportPromises]]</dfn>
          </td>
          <td>
            An empty [=list=]
          </td>
          <td>
            Pending {{HIDDevice/receiveFeatureReport()}} {{Promise}}s
          </td>
        </tr>
      </table>
      <dl>
        <dt>
          <dfn>oninputreport</dfn> attribute
        </dt>
        <dd>
          {{HIDDevice/oninputreport}} is an [=event handler IDL attribute=] for
          the <dfn>inputreport</dfn> event type.
        </dd>
        <dt>
          <dfn>opened</dfn> attribute
        </dt>
        <dd>
          <p>
            A flag indicating that the {{HIDDevice}} is ready to transfer data.
          </p>
          <p>
            The {{HIDDevice/opened}} getter steps are:
          </p>
          <ol>
            <li>If [=this=].{{HIDDevice/[[state]]}} is `opened`, then return
            `true`.
            </li>
            <li>Return `false`.
            </li>
          </ol>
        </dd>
        <dt>
          <dfn>vendorId</dfn> attribute
        </dt>
        <dd>
          <p>
            A <dfn>vendor ID</dfn> is an `unsigned short` value assigned by a
            vendor ID source that identifies the manufacturer of a device.
          </p>
          <p>
            The {{HIDDevice/vendorId}} attribute is the [=vendor ID=] of the
            device. If the device has no [=vendor ID=] or the [=vendor ID=]
            cannot be accessed, the attribute MUST be 0.
          </p>
          <p>
            The {{HIDDevice/vendorId}} getter steps are:
          </p>
          <ol>
            <li>Return [=this=].{{HIDDevice/[[vendorId]]}}.
            </li>
          </ol>
        </dd>
        <dt>
          <dfn>productId</dfn> attribute
        </dt>
        <dd>
          <p>
            A <dfn>product ID</dfn> is an `unsigned short` value assigned by
            the manufacturer of the device that identifies the product.
          </p>
          <p>
            The {{HIDDevice/productId}} attribute is the [=product ID=] of the
            device. If the device has no [=product ID=] or the [=product ID=]
            cannot be accessed, the attribute MUST be 0.
          </p>
          <p>
            The {{HIDDevice/productId}} getter steps are:
          </p>
          <ol>
            <li>Return [=this=].{{HIDDevice/[[productId]]}}.
            </li>
          </ol>
        </dd>
        <dt>
          <dfn>productName</dfn> attribute
        </dt>
        <dd>
          <p>
            A string identifying the product.
          </p>
          <p>
            For USB HID devices, the <dfn>product name</dfn> SHOULD contain the
            value of the string descriptor at the index `iProduct` specified in
            the Device Descriptor. For Bluetooth HID devices, the [=product
            name=] SHOULD contain the value of the Device Name characteristic.
            If the device has no [=product name=] or the [=product name=] is
            empty or cannot be accessed, the attribute MUST return an empty
            string.
          </p>
          <p>
            The {{HIDDevice/productName}} string SHOULD NOT contain any
            identifiers like a serial number or Bluetooth device address that
            could be used to uniquely identify the device.
          </p>
          <p>
            The {{HIDDevice/productName}} getter steps are:
          </p>
          <ol>
            <li>Return [=this=].{{HIDDevice/[[productName]]}}.
            </li>
          </ol>
        </dd>
        <dt>
          <dfn>collections</dfn> attribute
        </dt>
        <dd>
          <p>
            A [=sequence=] of {{HIDCollectionInfo}} representing the
            [=top-level collections=] in the [=report descriptor=].
          </p>
          <p>
            The {{HIDDevice/collections}} getter steps are:
          </p>
          <ol>
            <li>Return [=this=].{{HIDDevice/[[collections]]}}.
            </li>
          </ol>
          <div class="note">
            <dfn>Top-level collections</dfn> group items that serve similar
            purposes within the device. Applications look at the [=HID usage=]
            applied to [=top-level collections=] to identify devices. An
            application may not recognize a device if it does not follow the
            conventions for a particular type of device. Refer to
            [[USBIF-HID-USAGE]] for more information about the conventional
            behavior for standard HID devices.
          </div>
        </dd>
      </dl>
      <p>
        When an input report is received from a |device:HIDDevice|, run the
        following steps:
      </p>
      <ol>
        <li>If the input report is a [=blocked report=], abort these steps.
        </li>
        <li>Let |reportId:octet| be the report ID for this report, or 0 if the
        [=HID interface=] does not [=use report IDs=].
        </li>
        <li>Let |data:DataView| be a {{DataView}} created over the [=byte
        sequence=] representing the input report. If the [=HID interface=]
        [=uses report IDs=], the [=byte sequence=] MUST NOT include the report
        ID byte.
        </li>
        <li>[=Queue a global task=] on the [=relevant global object=] of
        [=this=] using the [=HID device task source=] to [=fire an event=]
        named {{inputreport}} at |device| using {{HIDInputReportEvent}} with
        its {{HIDInputReportEvent/device}} attribute initialized to |device|,
        its {{HIDInputReportEvent/reportId}} attribute initialized to
        |reportId|, and its {{HIDInputReportEvent/data}} attribute initialized
        to |data|.
        </li>
      </ol>
      <section>
        <h3>
          <dfn>open()</dfn> method
        </h3>
        <p>
          The {{HIDDevice/open()}} method steps are:
        </p>
        <ol>
          <li>Let |promise:Promise| be [=a new promise=].
          </li>
          <li>If [=this=].{{HIDDevice/[[state]]}} is not `"closed"`, then
          [=reject=] |promise| with a "{{InvalidStateError}}" {{DOMException}}
          and return |promise|.
          </li>
          <li>Set [=this=].{{HIDDevice/[[state]]}} to `"opening"`.
          </li>
          <li>Perform the following steps [=in parallel=]:
            <ol>
              <li>Invoke the operating system to open the HID device.
              </li>
              <li>If this fails for any reason, [=queue a global task=] on the
              [=relevant global object=] of [=this=] using the [=HID device
              task source=] to [=reject=] |promise| with a "{{NetworkError}}"
              {{DOMException}} and abort these steps.
              </li>
              <li>Set [=this=].{{HIDDevice/[[state]]}} to `"opened"`.
              </li>
              <li>[=Queue a global task=] on the [=relevant global object=] of
              [=this=] using the [=HID device task source=] to [=resolve=]
              |promise| with `undefined`.
              </li>
            </ol>
          </li>
          <li>Return |promise|.
          </li>
        </ol>
      </section>
      <section>
        <h3>
          <dfn>close()</dfn> method
        </h3>
        <p>
          The {{HIDDevice/close()}} method steps are:
        </p>
        <ol>
          <li>Let |promise:Promise| be [=a new promise=].
          </li>
          <li>If [=this=].{{HIDDevice/[[state]]}} is either `"forgotten"` or
          `"forgetting"`, then [=reject=] |promise| with a
          "{{InvalidStateError}}" {{DOMException}} and return |promise|.
          </li>
          <li>Set [=this=].{{HIDDevice/[[state]]}} to `"closing"`.
          </li>
          <li>[=list/For each=] |pendingPromise:Promise| of
          [=this=].{{HIDDevice/[[pendingSendReportPromises]]}}:
            <ol>
              <li>[=Reject=] |pendingPromise| with an "{{AbortError}}"
              {{DOMException}}.
              </li>
            </ol>
          </li>
          <li>[=list/Empty=]
          [=this=].{{HIDDevice/[[pendingSendReportPromises]]}}.
          </li>
          <li>[=list/For each=] |pendingPromise:Promise| of
          [=this=].{{HIDDevice/[[pendingSendFeatureReportPromises]]}}:
            <ol>
              <li>[=Reject=] |pendingPromise| with an "{{AbortError}}"
              {{DOMException}}.
              </li>
            </ol>
          </li>
          <li>[=list/Empty=]
          [=this=].{{HIDDevice/[[pendingSendFeatureReportPromises]]}}.
          </li>
          <li>[=list/For each=] |pendingPromise:Promise| of
          [=this=].{{HIDDevice/[[pendingReceiveFeatureReportPromises]]}}:
            <ol>
              <li>[=Reject=] |pendingPromise| with an "{{AbortError}}"
              {{DOMException}}.
              </li>
            </ol>
          </li>
          <li>[=list/Empty=]
          [=this=].{{HIDDevice/[[pendingReceiveFeatureReportPromises]]}}.
          </li>
          <li>Perform the following steps [=in parallel=]:
            <ol>
              <li>Invoke the operating system to close the HID device and
              release any associated resources.
              </li>
              <li>Set [=this=].{{HIDDevice/[[state]]}} to `"closed"`.
              </li>
              <li>[=Queue a global task=] on the [=relevant global object=] of
              [=this=] using the [=HID device task source=] to [=resolve=]
              |promise| with `undefined`.
              </li>
            </ol>
          </li>
          <li>Return |promise|.
          </li>
        </ol>
      </section>
      <section>
        <h3>
          <dfn>forget()</dfn> method
        </h3>
        <div class="note">
          <p>
            The user agent MAY decide to combine permissions across APIs, for
            instance tracking WebHID + WebUSB device access under a unified
            low-level device access permission. This is why this method may
            also revoke additional (unspecified yet) permissions in the future.
          </p>
        </div>
        <p>
          The {{HIDDevice/forget()}} method steps are:
        </p>
        <ol>
          <li>Let |promise:Promise| be [=a new promise=].
          </li>
          <li>Perform the following steps [=in parallel=]:
            <ol>
              <li>[=list/For each=] |device:HIDDevice| of
              [=this=].{{HID/[[devices]]}}:
                <ol>
                  <li>
                    If |device| does not share device access permissions with
                    the HIDDevice, then continue to the next device.
                  </li>
                  <li>Set |device|.{{HIDDevice/[[state]]}} to `"forgetting"`.
                  </li>
                  <li>[=list/For each=] |pendingPromise:Promise| of
                    |device|.{{HIDDevice/[[pendingSendReportPromises]]}}:
                      <ol>
                        <li>[=Reject=] |pendingPromise| with an "{{AbortError}}"
                        {{DOMException}}.
                        </li>
                      </ol>
                    </li>
                    <li>[=list/Empty=]
                    |device|.{{HIDDevice/[[pendingSendReportPromises]]}}.
                    </li>
                    <li>[=list/For each=] |pendingPromise:Promise| of
                      |device|.{{HIDDevice/[[pendingSendFeatureReportPromises]]}}:
                      <ol>
                        <li>[=Reject=] |pendingPromise| with an "{{AbortError}}"
                        {{DOMException}}.
                        </li>
                      </ol>
                    </li>
                    <li>[=list/Empty=]
                    |device|.{{HIDDevice/[[pendingSendFeatureReportPromises]]}}.
                    </li>
                    <li>[=list/For each=] |pendingPromise:Promise| of
                    |device|.{{HIDDevice/[[pendingReceiveFeatureReportPromises]]}}:
                      <ol>
                        <li>[=Reject=] |pendingPromise| with an "{{AbortError}}"
                        {{DOMException}}.
                        </li>
                      </ol>
                    </li>
                    <li>[=list/Empty=]
                    |device|.{{HIDDevice/[[pendingReceiveFeatureReportPromises]]}}.
                    </li>
                  <li>Invoke the user agent to revoke access to all the [=HID interfaces=]
                  exposed by |device|.
                  </li>
                  <li>Set |device|.{{HIDDevice/[[state]]}} to `"forgotten"`.
                  </li>
                </ol>
              </li>
              <li>[=Queue a global task=] on the [=relevant global object=] of
              [=this=] using the [=HID device task source=] to [=resolve=]
              |promise| with `undefined`.
              </li>
            </ol>
          </li>
          <li>Return |promise|.
          </li>
        </ol>
      </section>
      <section>
        <h3>
          <dfn>sendReport()</dfn> method
        </h3>
        <div class="note">
          <p>
            The {{HIDDevice/sendReport()}} method is used to send an output
            report with the specified |reportId:octet| and |data:BufferSource|.
            If the [=HID interface=] does not [=use report IDs=], pass 0
            instead of the report ID.
          </p>
          <p>
            For [=HID interfaces=] that [=use report IDs=], the report ID value
            0 is reserved and should not be used.
          </p>
        </div>
        <p>
          The {{HIDDevice/sendReport()}} method steps are:
        </p>
        <ol>
          <li>Let |promise:Promise| be [=a new promise=].
          </li>
          <li>If [=this=].{{HIDDevice/[[state]]}} is not `"opened"`, then
          [=reject=] |promise| with a "{{InvalidStateError}}" {{DOMException}}
          and return |promise|.
          </li>
          <li>If |reportId:octet| is 0 and the [=HID interface=] represented by
          [=this=] [=uses report IDs=], or if |reportId| is not 0 and the
          interface does not [=use report IDs=], then [=reject=] |promise| with
          a "{{TypeError}}" {{DOMException}} and return |promise|.
          </li>
          <li>[=list/Append=] |promise| to
          [=this=].{{HIDDevice/[[pendingSendReportPromises]]}}.
          </li>
          <li>Perform the following steps [=in parallel=]:
            <ol>
              <li>If this report is a [=blocked report=], [=queue a global
              task=] on the [=relevant global object=] of [=this=] using the
              [=HID device task source=] to [=reject=] |promise| with a
              "{{NotAllowedError}}" {{DOMException}} and abort these steps.
              </li>
              <li>Invoke the operating system to send an output report with the
              specified |reportId:octet| and |data:BufferSource|.
              </li>
              <li>If this fails for any reason, [=queue a global task=] on the
              [=relevant global object=] of [=this=] using the [=HID device
              task source=] to [=reject=] |promise| with a "{{NetworkError}}"
              {{DOMException}} and abort these steps.
              </li>
              <li>[=Queue a global task=] on the [=relevant global object=] of
              [=this=] using the [=HID device task source=] to [=resolve=]
              |promise| with `undefined`.
              </li>
            </ol>
          </li>
          <li>Return |promise|.
          </li>
        </ol>
      </section>
      <section>
        <h3>
          <dfn>sendFeatureReport()</dfn> method
        </h3>
        <div class="note">
          <p>
            The {{HIDDevice/sendFeatureReport()}} method is used to send a
            feature report with the specified |reportId:octet| and
            |data:BufferSource|. If the [=HID interface=] does not [=use report
            IDs=], pass 0 instead of the report ID.
          </p>
          <p>
            For [=HID interfaces=] that [=use report IDs=], the report ID value
            0 is reserved and should not be used.
          </p>
        </div>
        <p>
          The {{HIDDevice/sendFeatureReport()}} method steps are:
        </p>
        <ol>
          <li>Let |promise:Promise| be [=a new promise=].
          </li>
          <li>If [=this=].{{HIDDevice/[[state]]}} is not `"opened"`, then
          [=reject=] |promise| with a "{{InvalidStateError}}" {{DOMException}}
          and return |promise|.
          </li>
          <li>If |reportId:octet| is 0 and the [=HID interface=] represented by
          [=this=] [=uses report IDs=], or if |reportId| is not 0 and the
          interface does not [=use report IDs=], then [=reject=] |promise| with
          a "{{TypeError}}" {{DOMException}} and return |promise|.
          </li>
          <li>[=list/Append=] |promise| to
          [=this=].{{HIDDevice/[[pendingSendFeatureReportPromises]]}}.
          </li>
          <li>Perform the following steps [=in parallel=]:
            <ol>
              <li>If this report is a [=blocked report=], [=queue a global
              task=] on the [=relevant global object=] of [=this=] using the
              [=HID device task source=] to [=reject=] |promise| with a
              "{{NotAllowedError}}" {{DOMException}} and abort these steps.
              </li>
              <li>Invoke the operating system to send a feature report with the
              specified |reportId:octet| and |data:BufferSource|.
              </li>
              <li>If this fails for any reason, [=queue a global task=] on the
              [=relevant global object=] of [=this=] using the [=HID device
              task source=] to [=reject=] |promise| with a "{{NetworkError}}"
              {{DOMException}} and abort these steps.
              </li>
              <li>[=Queue a global task=] on the [=relevant global object=] of
              [=this=] using the [=HID device task source=] to [=resolve=]
              |promise| with `undefined`.
              </li>
            </ol>
          </li>
          <li>Return |promise|.
          </li>
        </ol>
      </section>
      <section>
        <h3>
          <dfn>receiveFeatureReport()</dfn> method
        </h3>
        <div class="note">
          <p>
            The {{HIDDevice/receiveFeatureReport()}} method is used to request
            a feature report with the specified |reportId:octet|. If the [=HID
            interface=] does not [=use report IDs=], pass 0 instead of the
            report ID.
          </p>
          <p>
            For [=HID interfaces=] that [=use report IDs=], the report ID value
            0 is reserved and should not be used.
          </p>
        </div>
        <p>
          The {{HIDDevice/receiveFeatureReport()}} method steps are:
        </p>
        <ol>
          <li>Let |promise:Promise| be [=a new promise=].
          </li>
          <li>If [=this=].{{HIDDevice/[[state]]}} is not `"opened"`, then
          [=reject=] |promise| with a "{{InvalidStateError}}" {{DOMException}}
          and return |promise|.
          </li>
          <li>If |reportId:octet| is 0 and the [=HID interface=] represented by
          [=this=] [=uses report IDs=], or if |reportId| is not 0 and the
          interface does not [=use report IDs=], then [=reject=] |promise| with
          a "{{TypeError}}" {{DOMException}} and return |promise|.
          </li>
          <li>[=list/Append=] |promise| to
          [=this=].{{HIDDevice/[[pendingReceiveFeatureReportPromises]]}}.
          </li>
          <li>Perform the following steps [=in parallel=]:
            <ol>
              <li>If this report is a [=blocked report=], [=queue a global
              task=] on the [=relevant global object=] of [=this=] using the
              [=HID device task source=] to [=reject=] |promise| with a
              "{{NotAllowedError}}" {{DOMException}} and abort these steps.
              </li>
              <li>Let |data:DataView| be a {{DataView}} created over the [=byte
              sequence=] representing the result of invoking the operating
              system to read a feature report with the specified
              |reportId:octet|.
                <div class="note">
                  |data| will contain whatever report data was received from
                  the operating system. If the device [=uses report IDs=] the
                  first byte may be the report ID. This byte is included
                  because the device may respond with other data in place of
                  the report ID.
                </div>
              </li>
              <li>If reading the feature report fails for any reason, [=queue a
              global task=] on the [=relevant global object=] of [=this=] using
              the [=HID device task source=] to [=reject=] |promise| with a
              "{{NetworkError}}" {{DOMException}} and abort these steps.
              </li>
              <li>[=Queue a global task=] on the [=relevant global object=] of
              [=this=] using the [=HID device task source=] to [=resolve=]
              |promise| with |data|.
              </li>
            </ol>
          </li>
          <li>Return |promise|.
          </li>
        </ol>
      </section>
    </section>
    <section data-dfn-for="HIDConnectionEvent">
      <h2>
        `HIDConnectionEvent` interface
      </h2>
      <pre class="idl">
        [Exposed=Window, SecureContext]
        interface HIDConnectionEvent : Event {
            constructor(DOMString type, HIDConnectionEventInit eventInitDict);
            [SameObject] readonly attribute HIDDevice device;
        };
      </pre>
      <dl>
        <dt>
          <dfn>device</dfn> attribute
        </dt>
        <dd>
          The {{HIDDevice}} instance that represents the connected or
          disconnected device.
        </dd>
      </dl>
      <section data-dfn-for="HIDConnectionEventInit">
        <h2>
          `HIDConnectionEventInit` dictionary
        </h2>
        <pre class="idl">
          dictionary HIDConnectionEventInit : EventInit {
              required HIDDevice device;
          };
        </pre>
        <dl>
          <dt>
            <dfn>device</dfn> member
          </dt>
          <dd>
            The device associated with the event.
          </dd>
        </dl>
      </section>
    </section>
    <section data-dfn-for="HIDInputReportEvent">
      <h2>
        `HIDInputReportEvent` interface
      </h2>
      <pre class="idl">
        [Exposed=Window, SecureContext]
        interface HIDInputReportEvent : Event {
            constructor(DOMString type, HIDInputReportEventInit eventInitDict);
            [SameObject] readonly attribute HIDDevice device;
            readonly attribute octet reportId;
            readonly attribute DataView data;
        };
      </pre>
      <dl>
        <dt>
          <dfn>device</dfn> attribute
        </dt>
        <dd>
          The {{HIDDevice}} instance that represents the [=HID interface=] that
          sent the input report.
        </dd>
        <dt>
          <dfn>reportId</dfn> attribute
        </dt>
        <dd>
          The one-byte identification prefix for this report, or 0 if the [=HID
          interface=] does not [=use report IDs=].
        </dd>
        <dt>
          <dfn>data</dfn> attribute
        </dt>
        <dd>
          A {{DataView}} containing the data from the input report, excluding
          the {{HIDInputReportEvent/reportId}} byte if the [=HID interface=]
          [=uses report IDs=].
        </dd>
      </dl>
      <section data-dfn-for="HIDInputReportEventInit">
        <h3>
          `HIDInputReportEventInit` dictionary
        </h3>
        <pre class="idl">
          dictionary HIDInputReportEventInit : EventInit {
              required HIDDevice device;
              required octet reportId;
              required DataView data;
          };
        </pre>
        <dl>
          <dt>
            <dfn>device</dfn> member
          </dt>
          <dd>
            The device associated with the event.
          </dd>
          <dt>
            <dfn>reportId</dfn> member
          </dt>
          <dd>
            The report ID for the input report.
          </dd>
          <dt>
            <dfn>data</dfn> member
          </dt>
          <dd>
            The data for the input report.
          </dd>
        </dl>
      </section>
    </section>
    <section data-dfn-for="HIDCollectionInfo">
      <h2>
        `HIDCollectionInfo` dictionary
      </h2>
      <pre class="idl">
        dictionary HIDCollectionInfo {
            unsigned short usagePage;
            unsigned short usage;
            octet type;
            sequence&lt;HIDCollectionInfo&gt; children;
            sequence&lt;HIDReportInfo&gt; inputReports;
            sequence&lt;HIDReportInfo&gt; outputReports;
            sequence&lt;HIDReportInfo&gt; featureReports;
        };
      </pre>
      <p>
        When a device is first connected to the system, the system MUST
        retrieve the [=report descriptor=] for each [=HID interface=] exposed
        by the device. The <dfn>Report descriptor</dfn> is a [=byte sequence=]
        that can be expanded into a hierarchical data structure describing the
        layout of each report supported by the device. The elements of this
        data structure are called items. Groups of items that share a
        relationship are called collections.
      </p>
      <p>
        A {{HIDCollectionInfo}} object represents a single collection within
        the [=report descriptor=]. When a collection contains nested
        collections, the nested collections are included as elements of
        {{HIDCollectionInfo/children}}.
      </p>
      <p>
        The {{HIDCollectionInfo/inputReports}},
        {{HIDCollectionInfo/outputReports}}, and
        {{HIDCollectionInfo/featureReports}} attributes contain [=sequences=]
        of {{HIDReportInfo}} that give information about each report described
        within this collection. For a [=top-level collection=], the
        {{HIDReportInfo}} represents a flattened view of all items that compose
        the report. The flattened view interleaves items contained in nested
        collections with items contained within the [=top-level collection=].
        For a nested collection, the {{HIDReportInfo}} includes only the items
        contained within the collection and its nested collections.
      </p>
      <dl>
        <dt>
          <dfn>usagePage</dfn> member
        </dt>
        <dd>
          <p>
            The [=usage page=] component of the [=HID usage=] associated with
            this collection.
          </p>
          <p>
            <dfn>HID usages</dfn> are constants that can be interpreted by an
            application to identify the purpose and meaning of an item or
            collection. A [=HID usage=] is an `unsigned long` value composed of
            an `unsigned short` <dfn>usage page</dfn> in the high order bits
            and an `unsigned short` <dfn>usage ID</dfn> in the low order bits.
            Standard [=HID usage=] values are described in [[USBIF-HID-CLASS]]
            and other documents published by the <a href=
            "https://www.usb.org/hid">USB Implementers Forum</a>.
          </p>
          <p>
            The [=HID usages=] of the [=top-level collections=] exposed by the
            device is used to identify the general device type.
          </p>
        </dd>
        <dt>
          <dfn>usage</dfn> member
        </dt>
        <dd>
          <p>
            The [=usage ID=] component of the [=HID usage=] associated with
            this collection.
          </p>
          <p>
            A [=usage ID=] is used to select an individual [=HID usage=] on a
            [=usage page=]. By convention, [=usage IDs=] 0x01 through 0x1F are
            reserved for [=top-level collections=].
          </p>
        </dd>
        <dt>
          <dfn>type</dfn> member
        </dt>
        <dd>
          <p>
            A value representing the [=collection type=].
          </p>
          <table class="simple">
            <thead>
              <tr>
                <th>
                  [=Collection type=]
                </th>
                <th>
                  Value
                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  Physical
                </td>
                <td>
                  0x00
                </td>
              </tr>
              <tr>
                <td>
                  Application
                </td>
                <td>
                  0x01
                </td>
              </tr>
              <tr>
                <td>
                  Logical
                </td>
                <td>
                  0x02
                </td>
              </tr>
              <tr>
                <td>
                  Report
                </td>
                <td>
                  0x03
                </td>
              </tr>
              <tr>
                <td>
                  Named Array
                </td>
                <td>
                  0x04
                </td>
              </tr>
              <tr>
                <td>
                  Usage Switch
                </td>
                <td>
                  0x05
                </td>
              </tr>
              <tr>
                <td>
                  Usage Modified
                </td>
                <td>
                  0x06
                </td>
              </tr>
              <tr>
                <td>
                  Reserved for future use
                </td>
                <td>
                  0x07 to 0x7F
                </td>
              </tr>
              <tr>
                <td>
                  Vendor-defined
                </td>
                <td>
                  0x80 to 0xFF
                </td>
              </tr>
            </tbody>
          </table>
          <p>
            Each [=collection type=] describes a different type of relationship
            among the grouped items. Refer to [[USBIF-HID-CLASS]] section
            6.2.2.6 for more information about [=collection types=].
          </p>
        </dd>
        <dt>
          <dfn>children</dfn> member
        </dt>
        <dd>
          A [=sequence=] of {{HIDCollectionInfo}} representing the collections
          nested within this collection.
        </dd>
        <dt>
          <dfn>inputReports</dfn> member
        </dt>
        <dd>
          A [=sequence=] of {{HIDReportInfo}} representing the input reports
          described within this collection.
        </dd>
        <dt>
          <dfn>outputReports</dfn> member
        </dt>
        <dd>
          A [=sequence=] of {{HIDReportInfo}} representing the output reports
          described within this collection.
        </dd>
        <dt>
          <dfn>featureReports</dfn> member
        </dt>
        <dd>
          A [=sequence=] of {{HIDReportInfo}} representing the feature reports
          described within this collection.
        </dd>
      </dl>
    </section>
    <section data-dfn-for="HIDReportInfo">
      <h2>
        `HIDReportInfo` dictionary
      </h2>
      <pre class="idl">
        dictionary HIDReportInfo {
            octet reportId;
            sequence&lt;HIDReportItem&gt; items;
        };
      </pre>
      <p>
        A {{HIDReportInfo}} represents one input, output, or feature report
        within the [=report descriptor=].
      </p>
      <dl>
        <dt>
          <dfn>reportId</dfn> member
        </dt>
        <dd>
          A [=HID interface=] <dfn data-lt="use report IDs">uses report
          IDs</dfn> if it prepends a one-byte identification prefix to each
          report transfer. The {{HIDReportInfo/reportId}} member is the prefix
          for this report if the interface [=uses report IDs=], or 0 otherwise.
        </dd>
        <dt>
          <dfn>items</dfn> member
        </dt>
        <dd>
          A [=sequence=] of {{HIDReportItem}} representing the fields of this
          report.
        </dd>
      </dl>
    </section>
    <section data-dfn-for="HIDReportItem">
      <h2>
        `HIDReportItem` dictionary
      </h2>
      <pre class="idl">
        dictionary HIDReportItem {
            boolean isAbsolute;
            boolean isArray;
            boolean isBufferedBytes;
            boolean isConstant;
            boolean isLinear;
            boolean isRange;
            boolean isVolatile;
            boolean hasNull;
            boolean hasPreferredState;
            boolean wrap;
            sequence&lt;unsigned long&gt; usages;
            unsigned long usageMinimum;
            unsigned long usageMaximum;
            unsigned short reportSize;
            unsigned short reportCount;
            byte unitExponent;
            HIDUnitSystem unitSystem;
            byte unitFactorLengthExponent;
            byte unitFactorMassExponent;
            byte unitFactorTimeExponent;
            byte unitFactorTemperatureExponent;
            byte unitFactorCurrentExponent;
            byte unitFactorLuminousIntensityExponent;
            long logicalMinimum;
            long logicalMaximum;
            long physicalMinimum;
            long physicalMaximum;
            sequence&lt;DOMString&gt; strings;
        };
      </pre>
      <dl>
        <dt>
          <dfn>isAbsolute</dfn> member
        </dt>
        <dd>
          `true` if the data is absolute (based on a fixed origin), or `false`
          if the data is relative (indicating the change in value from the last
          report).
        </dd>
        <dt>
          <dfn>isArray</dfn> member
        </dt>
        <dd>
          `true` if the item creates array data fields in reports where each
          data field contains an index corresponding to a pressed button or
          key, or `false` if the item creates variable data fields in reports
          where each data field contains a value.
        </dd>
        <dt>
          <dfn>isBufferedBytes</dfn> member
        </dt>
        <dd>
          `true` if the item emits a fixed-sized stream of bytes, or `false` if
          the item is a numeric quantity.
        </dd>
        <dt>
          <dfn>isConstant</dfn> member
        </dt>
        <dd>
          `true` if the item is a static read-only field and cannot be
          modified, or `false` if the item defines report fields that contain
          modifiable device data.
        </dd>
        <dt>
          <dfn>isLinear</dfn> member
        </dt>
        <dd>
          `true` if the item represents a linear relationship between what is
          measured and what is reported, or `false` if the data has been
          processed in some way.
        </dd>
        <dt>
          <dfn>isRange</dfn> member
        </dt>
        <dd>
          `true` if the item assigns usages from a [=HID usage=] range defined
          by {{HIDReportItem/usageMinimum}} and {{HIDReportItem/usageMaximum}},
          or `false` if the item has a [=sequence=] of [=HID usage=] values in
          {{HIDReportItem/usages}}.
        </dd>
        <dt>
          <dfn>isVolatile</dfn> member
        </dt>
        <dd>
          <p>
            `true` if the item value can change without host interaction, or
            `false` if the item value should only be changed by the host.
          </p>
          <p>
            Only used for Feature and Output items.
          </p>
        </dd>
        <dt>
          <dfn>hasNull</dfn> member
        </dt>
        <dd>
          `true` if the item has a null state in which it is not sending
          meaningful data, or `false` if it does not have a null state. When in
          a null state, the item will report a value outside of the specified
          {{HIDReportItem/logicalMinimum}} and
          {{HIDReportItem/logicalMaximum}}.
        </dd>
        <dt>
          <dfn>hasPreferredState</dfn> member
        </dt>
        <dd>
          `true` if the item has a preferred state to which it will return when
          the user is not physically interacting with the control, or `false`
          if the item does not have a preferred state.
        </dd>
        <dt>
          <dfn>wrap</dfn> member
        </dt>
        <dd>
          `true` if the item value rolls over when reaching either the extreme
          high or low value, or `false` if the item value does not roll over.
        </dd>
        <dt>
          <dfn>usages</dfn> member
        </dt>
        <dd>
          <p>
            If {{HIDReportItem/isRange}} is `true` or this item has no
            associated [=HID usage=] values, then {{HIDReportItem/usages}} MUST
            be undefined.
          </p>
          <p>
            If {{HIDReportItem/isRange}} is `false` then
            {{HIDReportItem/usages}} is a [=sequence=] of [=HID usage=] values
            associated with this item.
          </p>
        </dd>
        <dt>
          <dfn>usageMinimum</dfn> member
        </dt>
        <dd>
          <p>
            If {{HIDReportItem/isRange}} is `true` then
            {{HIDReportItem/usageMinimum}} contains the minimum [=HID usage=]
            value in the usage range associated with this item.
          </p>
          <p>
            If {{HIDReportItem/isRange}} is `false` then
            {{HIDReportItem/usageMinimum}} MUST be undefined.
          </p>
        </dd>
        <dt>
          <dfn>usageMaximum</dfn> member
        </dt>
        <dd>
          <p>
            If {{HIDReportItem/isRange}} is `true` then
            {{HIDReportItem/usageMaximum}} contains the maximum [=HID usage=]
            value in the usage range associated with this item.
          </p>
          <p>
            If {{HIDReportItem/isRange}} is `false` then
            {{HIDReportItem/usageMaximum}} MUST be undefined.
          </p>
        </dd>
        <dt>
          <dfn>reportSize</dfn> member
        </dt>
        <dd>
          The size of each report data field in bits. The
          {{HIDReportItem/reportSize}} MUST be greater than 0.
        </dd>
        <dt>
          <dfn>reportCount</dfn> member
        </dt>
        <dd>
          The number of fields included in the report for this item. The
          {{HIDReportItem/reportCount}} MUST be greater than 0.
        </dd>
        <dt>
          <dfn>unitExponent</dfn> member
        </dt>
        <dd>
          The value of the unit exponent, or 0 if the item has no unit
          definition.
        </dd>
        <dt>
          <dfn>unitSystem</dfn> member
        </dt>
        <dd>
          A {{HIDUnitSystem}} enum value specifying the unit system for the
          unit definition, or {{HIDUnitSystem/"none"}} if the item has no unit
          definition.
        </dd>
        <dt>
          <dfn>unitFactorLengthExponent</dfn> member
        </dt>
        <dd>
          The value of the exponent for the length unit (centimeters, radians,
          inch, or degrees) in the unit definition, or 0 if the item has no
          unit definition.
        </dd>
        <dt>
          <dfn>unitFactorMassExponent</dfn> member
        </dt>
        <dd>
          The value of the exponent for the mass unit (gram or slug) in the
          unit definition, or 0 if the item has no unit definition.
        </dd>
        <dt>
          <dfn>unitFactorTimeExponent</dfn> member
        </dt>
        <dd>
          The value of the exponent for the time unit (seconds) in the unit
          definition, or 0 if the item has no unit definition.
        </dd>
        <dt>
          <dfn>unitFactorTemperatureExponent</dfn> member
        </dt>
        <dd>
          The value of the exponent for the temperature unit (Kelvin or degrees
          Fahrenheit) in the unit definition, or 0 if the item has no unit
          definition.
        </dd>
        <dt>
          <dfn>unitFactorCurrentExponent</dfn> member
        </dt>
        <dd>
          The value of the exponent for the electrical current unit (Ampere) in
          the unit definition, or 0 if the item has no unit definition.
        </dd>
        <dt>
          <dfn>unitFactorLuminousIntensityExponent</dfn> member
        </dt>
        <dd>
          The value of the exponent for the luminous intensity unit (Candela)
          in the unit definition, or 0 if the item has no unit definition.
        </dd>
        <dt>
          <dfn>logicalMinimum</dfn> member
        </dt>
        <dd>
          The minimum extent of this item in logical units. This is the minimum
          value that a variable or array item will report.
        </dd>
        <dt>
          <dfn>logicalMaximum</dfn> member
        </dt>
        <dd>
          The maximum extent of this item in logical units. This is the maximum
          value that a variable or array item wll report.
        </dd>
        <dt>
          <dfn>physicalMinimum</dfn> member
        </dt>
        <dd>
          The minimum value for the physical extent of this item. This
          represents the {{HIDReportItem/logicalMinimum}} with units applied to
          it.
        </dd>
        <dt>
          <dfn>physicalMaximum</dfn> member
        </dt>
        <dd>
          The maximum value for the physical extent of this item. This
          represents the {{HIDReportItem/logicalMaximum}} with units applied to
          it.
        </dd>
        <dt>
          <dfn>strings</dfn> member
        </dt>
        <dd>
          The strings associated with this item, or an empty [=sequence=] if no
          strings are associated with this item.
        </dd>
      </dl>
    </section>
    <section data-dfn-for="HIDUnitSystem">
      <h2>
        <dfn>HIDUnitSystem</dfn> enum
      </h2>
      <p>
        [[USBIF-HID-CLASS]] section 6.2.2.7 defines four standard unit systems:
        SI Linear, SI Rotation, English Linear, and English Rotation. Each item
        uses one of these four unit systems, a vendor-defined unit system, or
        no unit system.
      </p>
      <pre class="idl">
        enum HIDUnitSystem {
            "none", "si-linear", "si-rotation", "english-linear",
            "english-rotation", "vendor-defined", "reserved"
        };
      </pre>
      <dl>
        <dt>
          <dfn>`"none"`</dfn>
        </dt>
        <dd>
          No unit system. Indicates that the item does not have a unit
          definition.
        </dd>
        <dt>
          <dfn>`"si-linear"`</dfn>
        </dt>
        <dd>
          The SI Linear unit system uses centimeter, gram, second, Kelvin,
          Ampere, Candela.
        </dd>
        <dt>
          <dfn>`"si-rotation"`</dfn>
        </dt>
        <dd>
          The SI Rotation unit system uses radian, gram, second, Kelvin,
          Ampere, Candela.
        </dd>
        <dt>
          <dfn>`"english-linear"`</dfn>
        </dt>
        <dd>
          The English Linear unit system uses inch, slug, second, degree
          Fahrenheit, Ampere, Candela.
        </dd>
        <dt>
          <dfn>`"english-rotation"`</dfn>
        </dt>
        <dd>
          The English Rotation unit system uses degree, slug, second, degree
          Fahrenheit, Ampere, Candela.
        </dd>
        <dt>
          <dfn>`"vendor-defined"`</dfn>
        </dt>
        <dd>
          A vendor-defined unit system.
        </dd>
        <dt>
          <dfn>`"reserved"`</dfn>
        </dt>
        <dd>
          Indicates that the device used a reserved value for its unit system.
        </dd>
      </dl>
    </section>
    <section id='enumeration'>
      <h2>
        Usage Examples
      </h2>
      <aside class="example">
        <p>
          Retrieve the list of devices that are accessible to the page. By
          default, nothing is accessible since the page has not been granted
          permission to access any devices.
        </p>
        <pre class="js">
          document.addEventListener('DOMContentLoaded', async () =&gt; {
            let devices = await navigator.hid.getDevices();
            devices.forEach(device =&gt; {
              console.log(`HID: ${device.productName}`);
            });
          });
        </pre>
      </aside>
      <aside class="example">
        <p>
          Register event listeners for connection and disconnection of HID
          devices.
        </p>
        <pre class="js">
          navigator.hid.addEventListener('connect', ({device}) =&gt; {
            console.log(`HID connected: ${device.productName}`);
          });

          navigator.hid.addEventListener('disconnect', ({device}) =&gt; {
            console.log(`HID disconnected: ${device.productName}`);
          });
        </pre>
      </aside>
      <aside class="example">
        <p>
          Devices are not accessible through {{HID/getDevices()}} and will not
          generate connection events until permission has been granted to
          access the device. The page may request permission using
          {{HID/requestDevice()}}. In this example, the page requests access to
          a device with [=vendor ID=] `0xABCD`. The device must also have a
          collection with [=usage page=] Consumer (`0x000C`) and [=usage ID=]
          Consumer Control (`0x0001`). The device with [=product ID=] `0x1234`
          has been reported as malfunctioning.
        </p>
        <pre class="js">
          let requestButton = document.getElementById("request-hid-device");
          requestButton.addEventListener("click", async () =&gt; {
            let device;
            try {
              const devices = await navigator.hid.requestDevice({
                filters: [
                  {
                    vendorId: 0xabcd,
                    usagePage: 0x000c,
                    usage: 0x0001,
                  },
                ],
                exclusionFilters: [
                  {
                    vendorId: 0xabcd,
                    productId: 0x1234,
                  }
                ],
              });
              device = devices[0];
            } catch (error) {
              console.log("An error occurred.");
            }

            if (!device) {
              console.log("No device was selected.");
            } else {
              console.log(`HID: ${device.productName}`);
            }
          });
        </pre>
      </aside>
      <aside class="example">
        <p>
          Register an event listener for input report events.
        </p>
        <pre class="js">
          device.oninputreport = ({device, reportId, data}) =&gt; {
            console.log(`Input report ${reportId} from ${device.productName}:`,
                        new Uint8Array(data.buffer));
          };

          if (!device.opened)
            await device.open();
        </pre>
      </aside>
      <aside class="example">
        <p>
          Send an output report.
        </p>
        <pre class="js">
          try {
            if (!device.opened)
              await device.open();

            const outputReportData = new Uint8Array([0x12, 0x34, 0x56, 0x78]);
            await device.sendReport(0x05, outputReportData);
            console.log("Output report sent");
          } catch (error) {
            console.log("An error occurred.")
          }
        </pre>
      </aside>
      <aside class="example">
        <p>
          Read and write a feature report.
        </p>
        <pre class="js">
          try {
            if (!device.opened)
              await device.open();

            const oldFeatureData = await device.receiveFeatureReport(0x80);
            console.log("Feature report received:", new Uint8Array(oldFeatureData.buffer));

            const newFeatureData = new Uint8Array([0x12, 0x34, 0x56, 0x78]);
            await device.sendFeatureReport(0x80, newFeatureData);
            console.log("Feature report sent");
          } catch (error) {
            console.log("An error occurred.")
          }
        </pre>
      </aside>
    </section>
    <section id="blocklist">
      <h2>
        The HID Blocklist
      </h2>
      <p>
        This specification relies on a blocklist file in the <a href=
        "https://github.com/WICG/webhid">https://github.com/WICG/webhid</a>
        repository to restrict the set of HID devices a website can access.
      </p>
      <p>
        The result of <dfn>parsing the blocklist</dfn> at a URL |url| is a
        [=sequence=] of dictionary objects produced by fetching |url| and
        parsing its contents as JSON.
      </p>
      <p>
        The <dfn>HID blocklist</dfn> is the result of [=parsing the blocklist=]
        at <a href=
        "https://github.com/WICG/webhid/blob/main/blocklist.txt">https://github.com/WICG/webhid/blob/main/blocklist.txt</a>
      </p>
      <p>
        A report is a <dfn>blocked report</dfn> if the following steps return
        `true`:
      </p>
      <ol>
        <li>[=list/For each=] |rule| of the [=HID blocklist=]:
          <ol>
            <li>If the report is [=blocked by a blocklist rule=] |rule| then
            return `true`.
            </li>
          </ol>
        </li>
        <li>Return `false`.
        </li>
      </ol>
      <p>
        A report is <dfn>blocked by a blocklist rule</dfn> |rule| if the
        following steps return `true`:
      </p>
      <ol>
        <li>Let |reportId:octet| be the report ID of the report, or 0 if the
        [=HID interface=] does not [=use report IDs=].
        </li>
        <li>Let |reportType| be `"input"` if the report is an input report,
        `"output"` if the report is an output report, or `"feature"` if the
        report is a feature report.
        </li>
        <li>Let |collection:HIDCollectionInfo| be the [=top-level collection=]
        that contains the report.
        </li>
        <li>If |rule| contains `"vendor"` and |rule|[`"vendor"`] is not
        |device|.{{HIDDevice/vendorId}}, return `false`.
        </li>
        <li>If |rule| contains `"product"` and |rule|[`"product"`] is not
        |device|.{{HIDDevice/productId}}, return `false`.
        </li>
        <li>If |rule| contains `"reportId"` and |rule|[`"reportId"`] is not
        |reportId|, return `false`.
        </li>
        <li>If |rule| contains `"reportType"` and |rule|[`"reportType"`] is not
        |reportType|, return `false`.
        </li>
        <li>If |rule| contains `"usagePage"` and |rule|[`"usagePage"`] is not
        |collection|["{{HIDCollectionInfo/usagePage}}"], return `false`.
        </li>
        <li>If |rule| contains `"usage"` and |rule|.[`"usage"`] is not
        |collection|["{{HIDCollectionInfo/usage}}"], return `false`.
        </li>
        <li>Return `true`.
        </li>
      </ol>
    </section>
    <section id='integrations'>
      <h2>
        Integrations
      </h2>
      <section id="permissions-policy">
        <h3>
          Permissions Policy
        </h3>
        <p>
          This specification defines a feature that controls whether the
          {{Navigator/hid}} attribute is exposed on the {{Navigator}} object.
        </p>
        <p>
          The feature name for this feature is `"hid"`.
        </p>
        <p>
          The [=default allowlist=] for this feature is `'self'`.
        </p>
      </section>
    </section>
    <section id='conformance'>
      <!-- This section is filled automatically by ReSpec. -->
    </section>
    <section class="appendix">
      <h2>
        Acknowledgements
      </h2>The following people contributed to the development of this
      document.
      <ul id="gh-contributors"></ul>
    </section>
  </body>
</html>
